{{ $year := "0" }}
{{ $newYear := "0" }}

{{ range (where .Site.Pages "Type" "post") }}
  {{ $newYear := .Date.Format "2006" }}

  {{ $year }}

  {{ if ne $newYear $year }}
    {{ if eq $year "0" }}
      </ul>
    {{ end }}
    {{ $year := $newYear }}
    <h3><a name="{{ $year }}">{{ $year }}</a></h3>
    <ul class="posts">
  {{ else }}
    <li>
      <span>{{ .Date.Format "Jan 2, 2006" }}</span> <a href="{{ .RelPermalink }}">{{ .Title }}</a>
    </li>
  {{ end }}
{{ end }}
</ul>
