<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Mario Carrion - Tip: Docker Development Environment</title><meta name=author content="Mario Carrion"><meta name=description content="The blog of Mario Carrion"><link rel=canonical href=http://www.mariocarrion.com/2017/01/09/docker-development-environment.html><link href="//fonts.googleapis.com/css?family=Inconsolata:400,700" rel=stylesheet><link rel="shortcut icon" href=/favicon.png><link rel=stylesheet href=/css/base.css><link rel=stylesheet href=/css/skeleton.css><link rel=stylesheet href=/css/screen.css><link rel=stylesheet href=/css/layout.css><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css><div class=container><div class="four columns sidebar"><nav><h1>Hello stranger!</h1><a href=/><img src=/images/logo.png id=logo alt="Blog logo" class=circular></a><h1>I&#39;m <a href=/about.html>Mario Carrion</a></h1><hr><ul id=blog-pages class=posts><li><span>&raquo; </span><a href=/about.html>About me</a><li><span>&raquo; </span><a href=/books.html>Books</a><li><span>&raquo; </span><a href=/disclaimer.html>Disclaimer</a><li><span>&raquo; </span><a href=https://docs.google.com/document/d/1i0W6qNfGMhTfwWTHBaaKzlN9HLGwbk3GLeh8VtVlhNM>Resume</a><li><span>&raquo; </span><a href=/archive.html#2017>All posts in 2017</a></ul><div id=social><div id=stalker><a href=https://github.com/MarioCarrion><i class="fa fa-github-square"></i></a><a href=http://stackoverflow.com/users/134327><i class="fa fa-stack-overflow"></i></a><a href=https://twitter.com/mariocarrion><i class="fa fa-twitter-square"></i></a><a href=https://www.linkedin.com/in/mariocarrion><i class="fa fa-linkedin-square"></i></a></div></div></nav></div><div class="eleven columns content"><p class=meta>Jan 09, 2017
<a href=/><i class="home fa fa-home"></i></a><h1 class=title>Tip: Docker Development Environment</h1><div id=post><p>One of my resolutions this year is to use Docker as the <a href=https://en.wikipedia.org/wiki/Single_source_of_truth>single source of truth</a> for all my development environments. So instead of installing the required software, like databases or development libraries, directly into my path I will be leveraging Docker and Docker Compose to have everything always working locally.<p>The main problem I currently face is my development setup. I ditched Linux about 7 years ago and migrated completely to macOS, and since Docker Mac is still a work in progress having a development environment based on Docker is a challenge.<p>The biggest issue is shared volumes, <a href=https://docs.docker.com/docker-for-mac/osxfs/#performance-issues-solutions-and-roadmap>the performance is not the same</a> compared to the Linux version. I spent some time researching about how to get the best performance with the current available tools, and after testing several tools I settle with <a href=https://github.com/IFSight/d4m-nfs>d4m-nfs</a> that internally uses NFS for sharing the volumes.<p>The keys to remember when using Docker and D4M are:<ul><li>When using D4M for the first time make sure the Shared Volumes are removed from Docker, leave <code>/tmp/</code> only. See the <a href=https://github.com/IFSight/d4m-nfs/blob/master/README.md>README</a>.<li>After cloning <strong>d4m-nfs</strong>, create the file <code>etc/d4m-nfs-mounts.txt</code>, make sure its contents are something like:</ul><pre><code>/Users/&lt;username&gt;:/Users/&lt;username&gt;
</code></pre><ul><li>When sharing volumes make sure the folder exists locally, recall the volume is being shared using NFS, the folder must exist in advance otherwise errors will be thrown. There&rsquo;s an option though, apparently you can use <code>root:wwheel</code> to <a href=https://github.com/IFSight/d4m-nfs/issues/25>automatically make the folders</a>, I tried it but did not work for me.<li>If you experience issues related to <a href=https://github.com/IFSight/d4m-nfs/issues/6>Mounts denied</a>, try to:<ol><li>Quit Docker, start it again and wait a bit.<li>Run the <code>d4m-nfs.sh</code> again.</ol></ul><h2 id=dockerizing-share-activerecord-models-gem>Dockerizing share-activerecord-models Gem</h2><p>Part of this exercise for me was to update my <a href=https://github.com/mariocarrion/share-activerecord-models>share-activerecord-models</a> gem, the one I introduced in the post <a href=/2016/02/26/sharing-models-between-projects.html>Sharing ActiveRecord models between projects</a>. The idea is simple, to use <code>docker-compose</code> for building the gem without installing anything else but <code>docker</code>.<p>Consider taking a look at the <a href=https://github.com/MarioCarrion/share-activerecord-models/commit/f56379b9e1f26e41659238808b36f44ff38174bd>change that introduced the Dockerization</a>, important bits are:<ul><li>New folder <a href=https://github.com/MarioCarrion/share-activerecord-models/commit/f56379b9e1f26e41659238808b36f44ff38174bd#diff-255bc4c176643aa7b3a8bcc6f88d53aa>.gems/</a>, which is shared volume, the idea is to have the gems <em>installed</em> locally not inside the image, similar to a <a href=https://rvm.io/gemsets/basics>gemset</a>, to speed-up building the image.<li><a href=https://github.com/MarioCarrion/share-activerecord-models/commit/f56379b9e1f26e41659238808b36f44ff38174bd#diff-e31bdf70b15c8f84344c332efe06900d>Database configuration change</a>, to use the linked container instead of the hardcoded localhost.</ul><p>With that I can easily interact with the gem by doing something like:<pre><code>docker-compose up
docker-compose run gem bundle exec rails generate migration create_my_table
docker-compose run gem bundle exec rails generate scenic:view my_materialized_table --materialized
docker-compose down
</code></pre></div><div id=related><h3>Posts</h3><ul class=posts><li><span>All in 2016!</span> <a href=/archive.html#2017>All posts from this year</a></ul><ul class=posts><li><span>Jan 03, 2017</span> <a href=http://www.mariocarrion.com/2017/01/03/ruby-performance-optimizations.html>Finished Reading: Ruby Performance Optimization</a><li><span>Jan 11, 2017</span> <a href=http://www.mariocarrion.com/2017/01/11/monitoring-docker.html>Finished Reading: Monitoring Docker</a></ul></div><div class=footer><div class=disclaimer><p>The postings on this site are my own and do not represent my
<a href=http://www.meredith.com/>employer's</a> positions, strategies or opinions.<p>&copy; Mario Carrion, 2004-2016 &mdash; built with <a href=https://gohugo.io/>Hugo</a> using a heavily modified version of <a href=https://github.com/swanson/lagom>Lagom theme</a></div></div></div></div><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-75640250-1','auto');ga('send','pageview');</script>