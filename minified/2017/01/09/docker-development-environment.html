<!doctype html><html lang=en-us><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=author content="Mario Carrion"><meta name=description content="Using Docker as your development environment"><meta property="og:title" content="Tip: Docker Development Environment"><meta property="og:description" content="Using Docker as your development environment"><meta property="og:type" content="article"><meta property="og:url" content="https://www.mariocarrion.com/2017/01/09/docker-development-environment.html"><meta property="article:published_time" content="2017-01-09T00:00:00+00:00"><meta property="article:modified_time" content="2017-01-09T00:00:00+00:00"><title>Tip: Docker Development Environment</title><link rel=canonical href=https://www.mariocarrion.com/2017/01/09/docker-development-environment.html><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inconsolata:400,700" rel=stylesheet><link rel=stylesheet href=/css/reset.css><link rel=stylesheet href=/css/main.css><link rel="shortcut icon" href=/favicon.png><link rel=alternate type=application/rss+xml title="RSS Feed" href=/index.xml><body><section class=header><div class=container><div class=content><a href=/><img class=avatar src=/img/logo.png></a>
<a href=/><div class=name>Mario Carrion</div></a><nav><ul><li class=nav-about><a href=https://www.mariocarrion.com/about.html><span>About</span></a><li class=nav-archive><a href=https://www.mariocarrion.com/archive.html><span>All Posts</span></a><li class=nav-books><a href=https://www.mariocarrion.com/books.html><span>Books</span></a><li class=nav-resume><a href=https://docs.google.com/document/d/1i0W6qNfGMhTfwWTHBaaKzlN9HLGwbk3GLeh8VtVlhNM><span>Resume</span></a></ul></nav></div></div></section><section class=icons><div class=container><div class=content><a href=/index.xml><img class=icon src=/img/rss.svg alt=rss></a>
<a href=//twitter.com/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/twitter.svg alt=twitter></a>
<a href=//gitlab.com/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/gitlab.svg alt=gitlab></a>
<a href=//github.com/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/github.svg alt=github></a>
<a href=//linkedin.com/in/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/linkedin.svg alt=linkedin></a></div></div></section><section class="main post non-narrow zero-top-spacing"><div class=container><div class=content><div class=front-matter><div class=title-container><div class=page-heading>Tip: Docker Development Environment</div><div class=initials><a href=https://www.mariocarrion.com></a></div></div><div class=meta><div class=date title="Mon Jan 9 2017 00:00:00 UTC">Jan 09, 2017</div></div></div><div class=markdown><p>One of my resolutions this year is to use Docker as the <a href=https://en.wikipedia.org/wiki/Single_source_of_truth>single source of truth</a> for all my development environments. So instead of installing the required software, like databases or development libraries, directly into my path I will be leveraging Docker and Docker Compose to have everything always working locally.<p>The main problem I currently face is my development setup. I ditched Linux about 7 years ago and migrated completely to macOS, and since Docker Mac is still a work in progress having a development environment based on Docker is a challenge.<p>The biggest issue is shared volumes, <a href=https://docs.docker.com/docker-for-mac/osxfs/#performance-issues-solutions-and-roadmap>the performance is not the same</a> compared to the Linux version. I spent some time researching about how to get the best performance with the current available tools, and after testing several tools I settle with <a href=https://github.com/IFSight/d4m-nfs>d4m-nfs</a> that internally uses NFS for sharing the volumes.<p>The keys to remember when using Docker and D4M are:<ul><li>When using D4M for the first time make sure the Shared Volumes are removed from Docker, leave <code>/tmp/</code> only. See the <a href=https://github.com/IFSight/d4m-nfs/blob/master/README.md>README</a>.<li><p>After cloning <strong>d4m-nfs</strong>, create the file <code>etc/d4m-nfs-mounts.txt</code>, make sure its contents are something like:<pre><code>/Users/&lt;username&gt;:/Users/&lt;username&gt;
</code></pre><li><p>When sharing volumes make sure the folder exists locally, recall the volume is being shared using NFS, the folder must exist in advance otherwise errors will be thrown. There&rsquo;s an option though, apparently you can use <code>root:wwheel</code> to <a href=https://github.com/IFSight/d4m-nfs/issues/25>automatically make the folders</a>, I tried it but did not work for me.<li><p>If you experience issues related to <a href=https://github.com/IFSight/d4m-nfs/issues/6>Mounts denied</a>, try to:<ol><li>Quit Docker, start it again and wait a bit.<li>Run the <code>d4m-nfs.sh</code> again.</ol></ul><h2 id=dockerizing-share-activerecord-models-gem>Dockerizing share-activerecord-models Gem</h2><p>Part of this exercise for me was to update my <a href=https://github.com/mariocarrion/share-activerecord-models>share-activerecord-models</a> gem, the one I introduced in the post <a href=/2016/02/26/sharing-models-between-projects.html>Sharing ActiveRecord models between projects</a>. The idea is simple, to use <code>docker-compose</code> for building the gem without installing anything else but <code>docker</code>.<p>Consider taking a look at the <a href=https://github.com/MarioCarrion/share-activerecord-models/commit/f56379b9e1f26e41659238808b36f44ff38174bd>change that introduced the Dockerization</a>, important bits are:<ul><li>New folder <a href=https://github.com/MarioCarrion/share-activerecord-models/commit/f56379b9e1f26e41659238808b36f44ff38174bd#diff-255bc4c176643aa7b3a8bcc6f88d53aa>.gems/</a>, which is shared volume, the idea is to have the gems <em>installed</em> locally not inside the image, similar to a <a href=https://rvm.io/gemsets/basics>gemset</a>, to speed-up building the image.<li><a href=https://github.com/MarioCarrion/share-activerecord-models/commit/f56379b9e1f26e41659238808b36f44ff38174bd#diff-e31bdf70b15c8f84344c332efe06900d>Database configuration change</a>, to use the linked container instead of the hardcoded localhost.</ul><p>With that I can easily interact with the gem by doing something like:<pre><code>docker-compose up
docker-compose run gem bundle exec rails generate migration create_my_table
docker-compose run gem bundle exec rails generate scenic:view my_materialized_table --materialized
docker-compose down
</code></pre><br><p class=back-to-posts><a href=/archive.html>Back to posts</a></div><br><div class=disqus></div></div></div></section><script async src="https://www.googletagmanager.com/gtag/js?id=UA-75640250-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-75640250-1');</script>