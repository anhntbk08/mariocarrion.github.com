<!doctype html><html lang=en-us><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content=True><meta name=MobileOptimized content=320><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content=no-referrer><meta name=author content="Mario Carrion"><meta name=description content='Since C&#43;&#43; includes exceptions improves applications&#39; lifetime while running, "catching" known errors always helps, but what about the pretty older (but nicer) C?? The following simulates Java&#39;s try-catch-finally. It&#39;s based on the code written by Francisco A. MÃ¡rquez, on his book.
File exception.h
#ifndef __EXCEPTION_H__
#define __EXCEPTION_H__
#include [signal .h] //Replace with "lower-than" "greather-than"
#include [setjmp .h]
typedef int exception_t;
extern exception_t
ARITHMETIC, /* SIGFPE */
HANGUP, /* SIGHUP */'><meta property=og:title content=Exceptions><meta property=og:description content='Since C&#43;&#43; includes exceptions improves applications&#39; lifetime while running, "catching" known errors always helps, but what about the pretty older (but nicer) C?? The following simulates Java&#39;s try-catch-finally. It&#39;s based on the code written by Francisco A. MÃ¡rquez, on his book.
File exception.h
#ifndef __EXCEPTION_H__
#define __EXCEPTION_H__
#include [signal .h] //Replace with "lower-than" "greather-than"
#include [setjmp .h]
typedef int exception_t;
extern exception_t
ARITHMETIC, /* SIGFPE */
HANGUP, /* SIGHUP */'><meta property=og:type content=article><meta property=og:url content=https://www.mariocarrion.com/2006/08/16/exceptions.html><meta property=article:published_time content=2006-08-16T22:37:42&#43;00:00><meta property=article:modified_time content=2006-08-16T22:37:42&#43;00:00><title>Exceptions</title><link rel=canonical href=https://www.mariocarrion.com/2006/08/16/exceptions.html><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inconsolata:400,700" rel=stylesheet><link rel=stylesheet href=/css/reset.css><link rel=stylesheet href=/css/main.css><link rel="shortcut icon" href=/favicon.png><link rel=alternate type=application/rss+xml title="RSS Feed" href=/index.xml><body><section class=header><div class=container><div class=content><a href=/><img class=avatar src=/img/logo.png></a>
<a href=/><div class=name>Mario Carrion</div></a><nav><ul><li class=nav-about><a href=https://www.mariocarrion.com/about.html><span>About</span></a><li class=nav-archive><a href=https://www.mariocarrion.com/archive.html><span>All Posts</span></a><li class=nav-books><a href=https://www.mariocarrion.com/books.html><span>Books</span></a><li class=nav-resume><a href=https://docs.google.com/document/d/1i0W6qNfGMhTfwWTHBaaKzlN9HLGwbk3GLeh8VtVlhNM><span>Resume</span></a></ul></nav></div></div></section><section class=icons><div class=container><div class=content><a href=/index.xml><img class=icon src=/img/rss.svg alt=rss></a>
<a href=//github.com/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/github.svg alt=github></a>
<a href=//twitter.com/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/twitter.svg alt=twitter></a>
<a href=//linkedin.com/in/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/linkedin.svg alt=linkedin></a></div></div></section><section class=main><div class=container><div class=content><div class=page-heading>Exceptions</div><div class=markdown><p>Since C++ includes exceptions improves applications' lifetime while running, "catching" known errors always helps, but what about the pretty older (but nicer) C?? The following simulates Java's <em>try-catch-finally</em>. It's based on the code written by Francisco A. MÃ¡rquez, on <a href=http://www.ra-ma.es/libros/0001692.htm>his book</a>.<p>File <em>exception.h</em><p><code lang=c>#ifndef __EXCEPTION_H__<br>#define __EXCEPTION_H__<br>#include [signal .h] //Replace with "lower-than" "greather-than"<br>#include [setjmp .h]<p>typedef int exception_t;<p>extern exception_t<br>ARITHMETIC, /* SIGFPE */<br>HANGUP, /* SIGHUP */<br>ILLEGAL_INSTRUCTION, /* SIGILL */<br>SEGMENT_VIOLATION, /* SIGSEGV */<br>TERMINATION, /* SIGTERM */<br>UNKNOWN;<p>extern jmp_buf __jmpbuf;<p>/*<br>* try {<br>* insert-code-here<br>* } catch (Exception) {<br>* deal-with-the-exception<br>* } finally {<br>* do-something<br>* }<br>* */<br>#define try {exception_t current_exception;\<br>sigset_t oset;\<br>struct sigaction oact;\<br>void exception_lock_signal (sigset_t *oset, struct sigaction *oact);\<br>void exception_unlock_signal (sigset_t *oset, struct sigaction *oact);\<br>exception_lock_signal (&oset, &oact);\<br>if ((current_exception = (exception_t) setjmp (__jmpbuf)) == 0)<br>#define catch(exception) else if (current_exception == (int) &exception)<br>#define finally exception_unlock_signal (&oset, &oact);}<br>#define throw(exception) longjmp (__jmpbuf, (int) &exception);<p>#endif</code><p>File <em>exception.c</em><p><code lang=c>#include [errno .h] //Replace with "lower-than" "greather-than"<br>#include [stdio .h]<br>#include "exception.h"<p>exception_t<br>ARITHMETIC,<br>HANGUP,<br>ILLEGAL_INSTRUCTION,<br>SEGMENT_VIOLATION,<br>TERMINATION,<br>UNKNOWN;<p>jmp_buf __jmpbuf;<p>void exception_error (int err, char *str)<br>{<br>printf ("EXCEPTION ERROR: (%i) %s\n", err, str);<br>}<p>void exception_manager (int signal)<br>{<br>switch (signal) {<br>case SIGFPE:<br>throw (ARITHMETIC);<br>break;<br>case SIGHUP:<br>throw (HANGUP);<br>break;<br>case SIGILL:<br>throw (ILLEGAL_INSTRUCTION);<br>break;<br>case SIGSEGV:<br>throw (SEGMENT_VIOLATION);<br>break;<br>case SIGTERM:<br>throw (TERMINATION);<br>break;<br>default:<br>throw (UNKNOWN);<br>}<br>}<p>void exception_lock_signal (sigset_t *oset, struct sigaction *oact)<br>{<br>int error = 0;<br>sigset_t set;<br>struct sigaction act;<p>sigemptyset (&set);<br>sigaddset (&set, SIGFPE);<br>sigaddset (&set, SIGHUP);<br>sigaddset (&set, SIGILL);<br>sigaddset (&set, SIGSEGV);<br>sigaddset (&set, SIGTERM);<br>if ((error = sigprocmask (SIG_UNBLOCK, &set, oset)) == -1)<br>exception_error (errno, "sigprocmask");<br>act.sa_handler = exception_manager;<br>sigfillset (&act.sa_mask);<br>act.sa_flags = SA_RESETHAND;<br>if ((error = sigaction (SIGFPE, &act, oact)) == -1)<br>exception_error (errno, "sigaction SIGFPE");<br>if ((error = sigaction (SIGHUP, &act, oact)) == -1)<br>exception_error (errno, "sigaction SIGHUP");<br>if ((error = sigaction (SIGILL, &act, oact)) == -1)<br>exception_error (errno, "sigaction SIGILL");<br>if ((error = sigaction (SIGSEGV, &act, oact)) == -1)<br>exception_error (errno, "sigaction SIGSEGV");<br>if ((error = sigaction (SIGTERM, &act, oact)) == -1)<br>exception_error (errno, "sigaction SIGTERM");<br>}<p>void exception_unlock_signal (sigset_t *oset, struct sigaction *oact)<br>{<br>int error = 0;<p>if ((error = sigprocmask (SIG_SETMASK, oset, NULL)) == -1)<br>exception_error (error, "sigprockmask SIG_SETMASK");<br>if ((error = sigaction (SIGFPE, oact, NULL)) == -1)<br>exception_error (error, "sigaction SIGFPE");<br>if ((error = sigaction (SIGHUP, oact, NULL)) == -1)<br>exception_error (error, "sigaction SIGHUP");<br>if ((error = sigaction (SIGILL, oact, NULL)) == -1)<br>exception_error (error, "sigaction SIGILL");<br>if ((error = sigaction (SIGSEGV, oact, NULL)) == -1)<br>exception_error (error, "sigaction SIGSEGV");<br>if ((error = sigaction (SIGTERM, oact, NULL)) == -1)<br>exception_error (error, "sigaction SIGTERM");<p>}</code><p>And yes... there is also the example code:<p><code lang=c>#include [stdio .h] //Replace with "lower-than" "greather-than"<br>#include "exception.h"<p>int main ()<br>{<br>exception_t Error_de_Lectura;<br>int x;<br>try {<br>printf ("Protected scope. BEGIN\n");<br>strcpy (NULL, "Nice!");<br>printf ("Protected scope. END\n");<br>} catch (Error_de_Lectura) {<br>printf ("Reading error\n");<br>} catch (ARITHMETIC) {<br>printf ("Arithmetic error\n");<br>throw (Error_de_Lectura);<br>} catch (ILLEGAL_INSTRUCTION) {<br>printf ("Instruccion ilegal");<br>} catch (SEGMENT_VIOLATION) {<br>printf ("Segmentation fault!.\n");<br>x = 0 /0;<br>} finally {<br>printf ("Finally reached\n");<br>}<br>return 0;<br>}</code><p>Awesome, isn't it?.</div></div></div></section>