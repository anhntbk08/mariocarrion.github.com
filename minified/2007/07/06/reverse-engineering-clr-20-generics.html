<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Mario Carrion - Reverse Engineering CLR 2.0 Generics</title><meta name=author content="Mario Carrion"><meta name=description content="The blog of Mario Carrion"><link rel=canonical href=http://www.mariocarrion.com/2007/07/06/reverse-engineering-clr-20-generics.html><link href="//fonts.googleapis.com/css?family=Inconsolata:400,700" rel=stylesheet><link rel="shortcut icon" href=/favicon.png><link rel=stylesheet href=/css/base.css><link rel=stylesheet href=/css/skeleton.css><link rel=stylesheet href=/css/screen.css><link rel=stylesheet href=/css/layout.css><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css><div class=container><div class="four columns sidebar"><nav><h1>Hello stranger!</h1><a href=/><img src=/images/logo.png id=logo alt="Blog logo" class=circular></a><h1>I&#39;m <a href=/about.html>Mario Carrion</a></h1><hr><ul id=blog-pages class=posts><li><span>&raquo; </span><a href=/about.html>About me</a><li><span>&raquo; </span><a href=/books.html>Books</a><li><span>&raquo; </span><a href=/disclaimer.html>Disclaimer</a><li><span>&raquo; </span><a href=https://docs.google.com/document/d/1i0W6qNfGMhTfwWTHBaaKzlN9HLGwbk3GLeh8VtVlhNM>Resume</a><li><span>&raquo; </span><a href=/archive.html#2007>All posts in 2007</a></ul><div id=social><div id=stalker><a href=https://github.com/MarioCarrion><i class="fa fa-github-square"></i></a><a href=http://stackoverflow.com/users/134327><i class="fa fa-stack-overflow"></i></a><a href=https://twitter.com/mariocarrion><i class="fa fa-twitter-square"></i></a><a href=https://www.linkedin.com/in/mariocarrion><i class="fa fa-linkedin-square"></i></a></div></div></nav></div><div class="eleven columns content"><p class=meta>Jul 06, 2007
<a href=/><i class="home fa fa-home"></i></a><h1 class=title>Reverse Engineering CLR 2.0 Generics</h1><div id=post><p>There are two goals with this new Reverse Engineering API:<ol><li>Implement an extensible, clean and easy-to-use Reverse Engineering API, hiding complex things by using UML-magic methods.<li>Implement CIL plugin by using this new API, to read 1.1 and 2.0 CLR assemblies.</ol><p>To accomplish second goal I decided to use <a href=http://www.mono-project.com/Cecil>Cecil</a> instead of <a href=http://msdn2.microsoft.com/en-us/library/system.reflection(VS.71).aspx>Reflection</a> because, IMO, Cecil has a cleaner API (not yet documented, but going to sources helps and, of course, you can <a href=http://groups.google.com.mx/group/mono-cecil>always ask</a>) and thinking on the future we might read the full assembly (including method body, for example) to define some diagrams, such as <a href=http://en.wikipedia.org/wiki/Sequence_diagram>Sequence Diagram</a>.<p>Most notable difference between first version and this new one, is the 2.0 CIL support, and reverse engineering Generics isn't that easy, to do so the following are my ideas to face and finish both implementations:<ol><li>Refactor CIL plugin to handle on a clean way all the Cecil's TypeReference, including PointerType, ArrayType, ReferenceType and GenericInstanceType. Today am using the if-else-if "pattern" not even close to best solution.<li>Test nUML to handle Templates, I did some tests and many worked, template binding and XMI exporting seems to crash, however template definition doesn't. The following is my test case:</ol><p><code lang=csharp>using System;<br>using System.IO;<br>using NUml.Xmi2;<br>using NUml.Uml2;<p>class MainClass<br>{<br>public static void Main(string[] args)<br>{<br>DataType TObj = Create.DataType ();<br>TObj.Name = "TKey";<br>DataType KObj = Create.DataType ();<br>KObj.Name = "TValue";<br>TemplateSignature signature = Create.TemplateSignature ();<br>ClassifierTemplateParameter T = Create.ClassifierTemplateParameter ();<br>ClassifierTemplateParameter K = Create.ClassifierTemplateParameter ();<br>T.Signature = signature;<br>T.Default = TObj;<br>K.Signature = signature;<br>K.Default = KObj;<br>signature.Parameter.Add (T);<br>signature.Parameter.Add (K);<br>Class klass = Create.Class ();<br>/* Systems.Collection.Dictionary`2[TKey , TValue] emulation */<br>klass.Name = "Dictionary";<br>klass.OwnedTemplateSignature = signature;<p>SerializationDriver driver = new SerializationDriver ();<br>driver.AddSerializer (new NUml.Uml2.Serialization.Serializer ());<br>driver.Serialize (new object [] { klass, T, K, TObj, KObj },<br>Console.OpenStandardOutput(), "urn:numl.sourceforge.net:testing:templates");<br>}<p>}</code><ol start=3><li>Implement the MonoUML visualizer, to show the Parameters defined on the Templates.<li>Test, test and test.</ol><p>If you are wondering about Templates and so on, UML 2 Super Structure (05-07-04) defines them from page 600 to 631, go ahead.</div><div id=related><h3>Posts</h3><ul class=posts><li><span>All in 2016!</span> <a href=/archive.html#2007>All posts from this year</a></ul><ul class=posts><li><span>Jul 02, 2007</span> <a href=http://www.mariocarrion.com/2007/07/02/ocl-editor-updated.html>OCL Editor, updated</a><li><span>Jul 14, 2007</span> <a href=http://www.mariocarrion.com/2007/07/14/reverse-engineering-clr-20-generics-2.html>Reverse Engineering CLR 2.0 Generics, 2</a></ul></div><div class=footer><div class=disclaimer><p>The postings on this site are my own and do not represent my
<a href=http://www.meredith.com/>employer's</a> positions, strategies or opinions.<p>&copy; Mario Carrion, 2004-2016 &mdash; built with <a href=https://gohugo.io/>Hugo</a> using a heavily modified version of <a href=https://github.com/swanson/lagom>Lagom theme</a></div></div></div></div>analytics