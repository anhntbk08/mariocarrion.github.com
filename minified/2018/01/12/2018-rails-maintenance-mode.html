<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Mario Carrion - Rails Tip: Maintenance Mode</title><meta name=author content="Mario Carrion"><meta name=description content="The blog of Mario Carrion"><link rel=canonical href=http://www.mariocarrion.com/2018/01/12/2018-rails-maintenance-mode.html><link href="//fonts.googleapis.com/css?family=Inconsolata:400,700" rel=stylesheet><link rel="shortcut icon" href=/favicon.png><link rel=stylesheet href=/css/base.css><link rel=stylesheet href=/css/skeleton.css><link rel=stylesheet href=/css/screen.css><link rel=stylesheet href=/css/layout.css><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css><div class=container><div class="four columns sidebar"><nav><h1>Hello stranger!</h1><a href=/><img src=/images/logo.png id=logo alt="Blog logo" class=circular></a><h1>I&#39;m <a href=/about.html>Mario Carrion</a></h1><hr><ul id=blog-pages class=posts><li><span>&raquo; </span><a href=/about.html>About me</a><li><span>&raquo; </span><a href=/books.html>Books</a><li><span>&raquo; </span><a href=/disclaimer.html>Disclaimer</a><li><span>&raquo; </span><a href=https://docs.google.com/document/d/1i0W6qNfGMhTfwWTHBaaKzlN9HLGwbk3GLeh8VtVlhNM>Resume</a><li><span>&raquo; </span><a href=/archive.html#2018>All posts in 2018</a></ul><div id=social><div id=stalker><a href=https://github.com/MarioCarrion><i class="fa fa-github-square"></i></a><a href=http://stackoverflow.com/users/134327><i class="fa fa-stack-overflow"></i></a><a href=https://twitter.com/mariocarrion><i class="fa fa-twitter-square"></i></a><a href=https://www.linkedin.com/in/mariocarrion><i class="fa fa-linkedin-square"></i></a></div></div></nav></div><div class="eleven columns content"><p class=meta>Jan 12, 2018
<a href=/><i class="home fa fa-home"></i></a><h1 class=title>Rails Tip: Maintenance Mode</h1><div id=post><p>Releasing new versions on live systems require sometimes to put the application into maintenance mode; it makes it easier to upgrade the system, it avoids errors as side effects related to data consistency and prevents poor user experience when the system is changing (<em>user confidence</em> is important).<p>Database migrations (including database schema changes and data restructuring) are usually the most difficult part of the deployment, not to mention recurrent jobs that are in charge of updating data periodically and the usual callbacks triggered after making changes to records.<p>To say the least it gets a bit complicated:<ol><li>To make sure all new changes satisfy correctly all the existing running systems and,<li>To know in advance what could be wrong when systems interact with each other behind the scenes.</ol><p>Looking for a solution to this problem I found a cool gem called <a href=https://github.com/biola/turnout><strong>turnout</strong></a>, it is really easy to use and it supports Rack so it works for Sinatra and Rails as well. Besides the <em>global</em> maintenance mode, there are other cool features like putting into maintenance mode specific endpoints via paths and restricting some IP address, just to mention a few.<p>Internally the way it works (in Rails) is <a href=https://github.com/biola/turnout/blob/aa4af887d609c93e2b50fd224a94221ecc1c2745/lib/turnout/engine.rb#L10>by adding itself as a middleware</a>, then it checks the existence of the temporary file to determine if it&rsquo;s enabled or not, <a href=https://github.com/biola/turnout/blob/aa4af887d609c93e2b50fd224a94221ecc1c2745/lib/rack/turnout.rb#L15-L27>it does this each request</a>, finally it renders the maintenance mode page when all the settings apply.<p>I found that using the <a href=https://github.com/biola/turnout/tree/aa4af887d609c93e2b50fd224a94221ecc1c2745#configuration>configuration</a> added as an initializer to the Rails application works better, because usually the maintenance mode message does not change, so when you want to enable this mode using the turnout rake tasks with no extra parameters is enough.<p><strong>turnout</strong> does what advertises correctly however <em>putting into maintenance mode</em> your application is not something that happens <strong>all</strong> the time during deployment, so instead of adding it directly to the Gemfile I recommend creating a patch that then is applied <strong>specifically</strong> when maintenance mode is required, that way we avoid this extra middleware call that check the existence of the file (for every single request). The con of this extra step during the process is that deployment is more convoluted but then again there&rsquo;s no need to put the Rails Application into maintenance mode every single time, so if I&rsquo;m planning to put the application into maintenance mode I know for sure I have to <em>patch it</em> first, so this for me works.</div><div id=related><h3>Posts</h3><ul class=posts><li><a href=/archive.html#2018>All posts this year 2018</a></ul><ul class=posts><li><span>Jan 04, 2018</span> <a href=http://www.mariocarrion.com/2018/01/04/2018-looking-back-at-2017.html>Looking back at The Past and envisioning The Future</a><li><span>Jan 28, 2018</span> <a href=http://www.mariocarrion.com/2018/01/28/the-managers-path.html>Finished Reading: The Manager&#39;s Path</a></ul></div><div class=footer><div class=disclaimer><p>The postings on this site are my own and do not represent my
<a href=http://www.meredith.com/>employer's</a> positions, strategies or opinions.<p>&copy; Mario Carrion, 2004-2016 &mdash; built with <a href=https://gohugo.io/>Hugo</a> using a heavily modified version of <a href=https://github.com/swanson/lagom>Lagom theme</a></div></div></div></div><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-75640250-1','auto');ga('send','pageview');</script>