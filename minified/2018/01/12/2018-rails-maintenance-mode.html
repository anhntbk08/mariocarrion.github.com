<!doctype html><html lang=en-us><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=author content="Mario Carrion"><meta name=description content="How to put Rails Applications into maintenance mode?"><meta property="og:title" content="Rails Tip: Maintenance Mode"><meta property="og:description" content="How to put Rails Applications into maintenance mode?"><meta property="og:type" content="article"><meta property="og:url" content="https://www.mariocarrion.com/2018/01/12/2018-rails-maintenance-mode.html"><meta property="article:published_time" content="2018-01-12T00:00:00+00:00"><meta property="article:modified_time" content="2018-01-12T00:00:00+00:00"><title>Rails Tip: Maintenance Mode</title><link rel=canonical href=https://www.mariocarrion.com/2018/01/12/2018-rails-maintenance-mode.html><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inconsolata:400,700" rel=stylesheet><link rel=stylesheet href=/css/reset.css><link rel=stylesheet href=/css/main.css><link rel="shortcut icon" href=/favicon.png><link rel=alternate type=application/rss+xml title="RSS Feed" href=/index.xml><body><section class=header><div class=container><div class=content><a href=/><img class=avatar src=/img/logo.png></a>
<a href=/><div class=name>Mario Carrion</div></a><nav><ul><li class=nav-about><a href=https://www.mariocarrion.com/about.html><span>About</span></a><li class=nav-archive><a href=https://www.mariocarrion.com/archive.html><span>All Posts</span></a><li class=nav-books><a href=https://www.mariocarrion.com/books.html><span>Books</span></a><li class=nav-resume><a href=https://docs.google.com/document/d/1i0W6qNfGMhTfwWTHBaaKzlN9HLGwbk3GLeh8VtVlhNM><span>Resume</span></a></ul></nav></div></div></section><section class=icons><div class=container><div class=content><a href=/index.xml><img class=icon src=/img/rss.svg alt=rss></a>
<a href=//twitter.com/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/twitter.svg alt=twitter></a>
<a href=//gitlab.com/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/gitlab.svg alt=gitlab></a>
<a href=//github.com/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/github.svg alt=github></a>
<a href=//linkedin.com/in/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/linkedin.svg alt=linkedin></a></div></div></section><section class="main post non-narrow zero-top-spacing"><div class=container><div class=content><div class=front-matter><div class=title-container><div class=page-heading>Rails Tip: Maintenance Mode</div><div class=initials><a href=https://www.mariocarrion.com></a></div></div><div class=meta><div class=date title="Fri Jan 12 2018 00:00:00 UTC">Jan 12, 2018</div></div></div><div class=markdown><p>Releasing new versions on live systems require sometimes to put the application into maintenance mode; it makes it easier to upgrade the system, it avoids errors as side effects related to data consistency and prevents poor user experience when the system is changing (<em>user confidence</em> is important).<p>Database migrations (including database schema changes and data restructuring) are usually the most difficult part of the deployment, not to mention recurrent jobs that are in charge of updating data periodically and the usual callbacks triggered after making changes to records.<p>To say the least it gets a bit complicated:<ol><li>To make sure all new changes satisfy correctly all the existing running systems and,<li>To know in advance what could be wrong when systems interact with each other behind the scenes.</ol><p>Looking for a solution to this problem I found a cool gem called <a href=https://github.com/biola/turnout><strong>turnout</strong></a>, it is really easy to use and it supports Rack so it works for Sinatra and Rails as well. Besides the <em>global</em> maintenance mode, there are other cool features like putting into maintenance mode specific endpoints via paths and restricting some IP address, just to mention a few.<p>Internally the way it works (in Rails) is <a href=https://github.com/biola/turnout/blob/aa4af887d609c93e2b50fd224a94221ecc1c2745/lib/turnout/engine.rb#L10>by adding itself as a middleware</a>, then it checks the existence of the temporary file to determine if it&rsquo;s enabled or not, <a href=https://github.com/biola/turnout/blob/aa4af887d609c93e2b50fd224a94221ecc1c2745/lib/rack/turnout.rb#L15-L27>it does this each request</a>, finally it renders the maintenance mode page when all the settings apply.<p>I found that using the <a href=https://github.com/biola/turnout/tree/aa4af887d609c93e2b50fd224a94221ecc1c2745#configuration>configuration</a> added as an initializer to the Rails application works better, because usually the maintenance mode message does not change, so when you want to enable this mode using the turnout rake tasks with no extra parameters is enough.<p><strong>turnout</strong> does what advertises correctly however <em>putting into maintenance mode</em> your application is not something that happens <strong>all</strong> the time during deployment, so instead of adding it directly to the Gemfile I recommend creating a patch that then is applied <strong>specifically</strong> when maintenance mode is required, that way we avoid this extra middleware call that check the existence of the file (for every single request). The con of this extra step during the process is that deployment is more convoluted but then again there&rsquo;s no need to put the Rails Application into maintenance mode every single time, so if I&rsquo;m planning to put the application into maintenance mode I know for sure I have to <em>patch it</em> first, so this for me works.</p><br><p class=back-to-posts><a href=/archive.html>Back to posts</a></div><br><div class=disqus></div></div></div></section>