<!doctype html><html lang=en-us><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=author content="Mario Carrion"><meta name=description content="DDD &#43; Go: Part 3."><meta property="og:title" content="Domain Driven Design and Go: Part 3, Domain Modeling"><meta property="og:description" content="DDD &#43; Go: Part 3."><meta property="og:type" content="article"><meta property="og:url" content="https://www.mariocarrion.com/2018/11/27/domain-driven-design-go-part-3.html"><meta property="article:published_time" content="2018-11-27T00:00:00&#43;00:00"><meta property="article:modified_time" content="2018-11-27T00:00:00&#43;00:00"><title>Domain Driven Design and Go: Part 3, Domain Modeling</title><link rel=canonical href=https://www.mariocarrion.com/2018/11/27/domain-driven-design-go-part-3.html><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inconsolata:400,700" rel=stylesheet><link rel=stylesheet href=/css/reset.css><link rel=stylesheet href=/css/main.css><link rel="shortcut icon" href=/favicon.png><link rel=alternate type=application/rss+xml title="RSS Feed" href=/index.xml><body><section class=header><div class=container><div class=content><a href=/><img class=avatar src=/img/logo.png></a>
<a href=/><div class=name>Mario Carrion</div></a><nav><ul><li class=nav-about><a href=https://www.mariocarrion.com/about.html><span>About</span></a><li class=nav-archive><a href=https://www.mariocarrion.com/archive.html><span>All Posts</span></a><li class=nav-books><a href=https://www.mariocarrion.com/books.html><span>Books</span></a><li class=nav-resume><a href=https://docs.google.com/document/d/1i0W6qNfGMhTfwWTHBaaKzlN9HLGwbk3GLeh8VtVlhNM><span>Resume</span></a></ul></nav></div></div></section><section class=icons><div class=container><div class=content><a href=/index.xml><img class=icon src=/img/rss.svg alt=rss></a>
<a href=//twitter.com/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/twitter.svg alt=twitter></a>
<a href=//gitlab.com/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/gitlab.svg alt=gitlab></a>
<a href=//github.com/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/github.svg alt=github></a>
<a href=//linkedin.com/in/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/linkedin.svg alt=linkedin></a></div></div></section><section class="main post non-narrow zero-top-spacing"><div class=container><div class=content><div class=front-matter><div class=title-container><div class=page-heading>Domain Driven Design and Go: Part 3, Domain Modeling</div><div class=initials><a href=https://www.mariocarrion.com></a></div></div><div class=meta><div class=date title="Tue Nov 27 2018 00:00:00 UTC">Nov 27, 2018</div></div></div><div class=markdown><h2 id=introduction>Introduction</h2><p><a href=/2018/11/13/domain-driven-design-go-part-2.html>We already implemented 3 of 8 rules</a>, those three already model the main game rules, the <em>&ldquo;non-interactive&rdquo;</em> things: boards, cards and deck; what we need next are the <em>&ldquo;interactive&rdquo;</em> things: players and their actions. Specifically we must implement the following:<ul><li>Given tablas are unique during the duration of the game,<li>There are N players, each player is given one Tabla (Board),<li>There&rsquo;s a Cantor (Announcer), who is in charge of randomly selecting cards from the deck,<li>Players have to listen to the announced cards and mark them on their boards, and<li>The winner is determined by the first player who shouts &ldquo;LOTER&IACUTE;!&rdquo;</ul><h1 id=iteration-2>Iteration #2</h1><p><a href=https://github.com/MarioCarrion/loteria/compare/c1c937a..a8cd79a>Diff implementing this iteration</a>.<p>From reading the requirements we can tell there are two subjects: <code>Caller</code> and <code>Player</code>, the <code>Caller</code> is the one announcing the game (orchestrating the game and publishing the called cards) and the <code>Player</code>s are the ones listening (are subscribed) to the game. (Please notice I will not cover the specific event handlers in this iteration, I will do that next time).<p>Taking those requirements we can model two concrete subjects accordingly, first one is the <em>Caller</em> which acts a game host, it does the following:<ul><li>Accepts new players: <code>Players have to listen to the announced cards</code>,<li>Assigns unique and random boards to those players: <code>There are N players, each player is given one Tabla (Board)</code> and <code>Given tablas are unique during the duration of the game</code>,<li>Announces cards: <code>Announcer is in charge of randomly selecting cards from the deck</code>, and<li>Validates the players really won when they say they did: <code>The winner is determined by the first player who shouts &quot;LOTERIA&quot;</code>.</ul><p>The second one is the <em>Player</em>:<ul><li>Has one randomized/unique board: <code>Each player is given one Tabla (Board)</code> and <code>Given tablas are unique during the duration of the game</code>,<li>Interact with the <em>Board</em> after listening to the <em>Caller</em>: <code>Players have to listen to the announced cards and mark them on their boards</code>, and<li>They indicate to the <em>Caller</em> they won: <code>The winner is determined by the first player who shouts &quot;LOTERIA!&quot;</code>.</ul><h2 id=caller>Caller</h2><p>To satisfy the requirements the <code>Caller</code> requires keeping track of:<ul><li><code>Deck</code> of shuffled cards: to properly announce the cards,<li><code>Players</code> playing the game, to properly determine the winner,<li><code>Boards</code> assigned to the players: to properly assign unique boards and determine the winner,</ul><p>For shuffling and announcing cards the original <code>Deck</code> type was converted into a struct, and <code>Shuffe()</code> and <code>Select()</code> methods <a href=https://github.com/MarioCarrion/loteria/blob/a8cd79ada141f0462d9862e4bb5ad2bc0fda4de2/card.go#L163-L181>were implemented</a>.<p>A new <code>Player</code> type <a href=https://github.com/MarioCarrion/loteria/blob/a8cd79ada141f0462d9862e4bb5ad2bc0fda4de2/player.go#L8-L12>was added</a>, this is a simple one so far, what&rsquo;s important is that the <code>Caller</code> keeps that of those in a map by using their unique name.<p>To determine the uniqueness of the <code>Board</code>s, a <a href=https://github.com/MarioCarrion/loteria/blob/a8cd79ada141f0462d9862e4bb5ad2bc0fda4de2/board.go#L86-L100>new method</a> was added:<div class=highlight style=background:#272822><pre style=line-height:125%><code class=language-go data-lang=go><span></span><span style=color:#66d9ef>func</span> <span style=color:#f8f8f2>(</span><span style=color:#a6e22e>b</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Board</span><span style=color:#f8f8f2>)</span> <span style=color:#a6e22e>ID</span><span style=color:#f8f8f2>()</span> <span style=color:#a6e22e>BoardID</span> <span style=color:#f8f8f2>{</span>
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>b</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>id</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> <span style=color:#f8f8f2>{</span>
		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>b</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>id</span>
	<span style=color:#f8f8f2>}</span>

	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>res</span> <span style=color:#66d9ef>uint64</span>
	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>b</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>cardsMap</span> <span style=color:#f8f8f2>{</span>
		<span style=color:#a6e22e>res</span> <span style=color:#f92672>|=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#f8f8f2>uint64(</span><span style=color:#a6e22e>c</span><span style=color:#f8f8f2>)</span>
	<span style=color:#f8f8f2>}</span>

	<span style=color:#a6e22e>b</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>id</span> <span style=color:#f8f8f2>=</span> <span style=color:#a6e22e>BoardID</span><span style=color:#f8f8f2>(</span><span style=color:#a6e22e>res</span><span style=color:#f8f8f2>)</span>

	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>b</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>id</span>
<span style=color:#f8f8f2>}</span>
</code></pre></div><p>Recall we <a href=https://github.com/MarioCarrion/loteria/blob/a8cd79ada141f0462d9862e4bb5ad2bc0fda4de2/board.go#L38>keep track</a> of the added cards on the board, and each board represents an <code>int64</code> with one bit enabled, so we can easily determine the unique ID using bit masking again. Keeping that information in a <code>map</code> allows to satisfy the uniqueness requirement, not to mention that the same <code>map</code> is used to <a href=https://github.com/MarioCarrion/loteria/blob/a8cd79ada141f0462d9862e4bb5ad2bc0fda4de2/caller.go#L68-L74>mark off</a> our already assigned boards to later determine if the player is really a winner.<h2 id=player>Player</h2><p>To satisfy the requirements, the <code>Player</code> requires doing two things:<ul><li>Marking off the <code>Board</code>, and<li>Shouting &ldquo;LOTER&Iacute;A!&ldquo;.</ul><p>This type, so far, is a simple one, it basically <a href=https://github.com/MarioCarrion/loteria/blob/a8cd79ada141f0462d9862e4bb5ad2bc0fda4de2/player.go#L23-L31>delegates both actions to the Board</a> which already implements them.<h2 id=putting-everything-together>Putting everything together</h2><p>Like I mentioned in the beginning this still requires a bit of event publishing and subscription to properly simulate a real game, however the current code implements successfully the business requirements, there&rsquo;s a <a href=https://github.com/MarioCarrion/loteria/blob/a8cd79ada141f0462d9862e4bb5ad2bc0fda4de2/cmd/main.go#L10-L48>command already available that runs all of this</a>. Feel free to check it out.<p><a data-flickr-embed=true href=https://www.flickr.com/photos/mariocarrion/32211887108/in/dateposted-public/ title="Loteria DDD 3"><img src=https://farm5.staticflickr.com/4912/32211887108_85921ab947_z.jpg width=640 height=321 alt="Loteria DDD 3"></a><script async src=//embedr.flickr.com/assets/client-code.js></script><hr><p>It looks like we made significant progress!! Let’s take a break for now, digest everything and come back tomorrow.</p><br><p class=back-to-posts><a href=/archive.html>Back to posts</a></div><br><div class=disqus></div></div></div></section>