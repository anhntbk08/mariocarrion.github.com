<!doctype html><html lang=en-us><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=author content="Mario Carrion"><meta name=description content="How to use generate JSON Web Key Sets"><meta property="og:title" content="Go Tip: Generating JSON Web Key Sets"><meta property="og:description" content="How to use generate JSON Web Key Sets"><meta property="og:type" content="article"><meta property="og:url" content="https://www.mariocarrion.com/2018/08/06/go-generating-json-web-key-sets.html"><meta property="article:published_time" content="2018-08-06T00:00:00+00:00"><meta property="article:modified_time" content="2018-08-06T00:00:00+00:00"><title>Go Tip: Generating JSON Web Key Sets</title><link rel=canonical href=https://www.mariocarrion.com/2018/08/06/go-generating-json-web-key-sets.html><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inconsolata:400,700" rel=stylesheet><link rel=stylesheet href=/css/reset.css><link rel=stylesheet href=/css/main.css><link rel="shortcut icon" href=/favicon.png><link rel=alternate type=application/rss+xml title="RSS Feed" href=/index.xml><body><section class=header><div class=container><div class=content><a href=/><img class=avatar src=/img/logo.png></a>
<a href=/><div class=name>Mario Carrion</div></a><nav><ul><li class=nav-about><a href=https://www.mariocarrion.com/about.html><span>About</span></a><li class=nav-archive><a href=https://www.mariocarrion.com/archive.html><span>All Posts</span></a><li class=nav-books><a href=https://www.mariocarrion.com/books.html><span>Books</span></a><li class=nav-resume><a href=https://docs.google.com/document/d/1i0W6qNfGMhTfwWTHBaaKzlN9HLGwbk3GLeh8VtVlhNM><span>Resume</span></a></ul></nav></div></div></section><section class=icons><div class=container><div class=content><a href=/index.xml><img class=icon src=/img/rss.svg alt=rss></a>
<a href=//twitter.com/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/twitter.svg alt=twitter></a>
<a href=//gitlab.com/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/gitlab.svg alt=gitlab></a>
<a href=//github.com/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/github.svg alt=github></a>
<a href=//linkedin.com/in/MarioCarrion target=_blank rel=noopener><img class=icon src=/img/linkedin.svg alt=linkedin></a></div></div></section><section class="main post non-narrow zero-top-spacing"><div class=container><div class=content><div class=front-matter><div class=title-container><div class=page-heading>Go Tip: Generating JSON Web Key Sets</div><div class=initials><a href=https://www.mariocarrion.com></a></div></div><div class=meta><div class=date title="Mon Aug 6 2018 00:00:00 UTC">Aug 06, 2018</div></div></div><div class=markdown><p>Previously I blogged about <a href=/2018/07/16/azure-active-directory-jwt.html>using ActiveDirectory and JWT</a> with Go, well this quick tip is somehow related to that post, it&rsquo;s for generating JSON Web Key Sets that should help for creating a <em>real</em> valid JSON or for testing local-only values.<p>There&rsquo;s a <a href=https://gitlab.com/MarioCarrion/blog-examples/tree/master/2018/08/06>full example</a> showing this in action, feel free to explore <a href=https://gitlab.com/MarioCarrion/blog-examples>the repo</a>.<hr><p>This example uses the great <a href=https://github.com/square/go-jose/tree/v2.1.7>go-jose</a> package by <a href=http://square.github.io/>Square</a>, the final snippet code <a href=https://gitlab.com/MarioCarrion/blog-examples/blob/master/2018/08/06/main.go#L39-68>looks like this</a>:<div class=highlight style=background:#272822><pre style=line-height:125%><code class=language-go data-lang=go><span></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>generateJWTWithKeyID</span><span style=color:#f8f8f2>()</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>jose</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>JSONWebKeySet</span> <span style=color:#f8f8f2>{</span>
	<span style=color:#a6e22e>rsaKey</span><span style=color:#f8f8f2>,</span> <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>rsa</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>GenerateKey</span><span style=color:#f8f8f2>(</span><span style=color:#a6e22e>rand</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>Reader</span><span style=color:#f8f8f2>,</span> <span style=color:#ae81ff>2048</span><span style=color:#f8f8f2>)</span>           <span style=color:#75715e>// XXX Check err</span>
	<span style=color:#a6e22e>serialNumber</span><span style=color:#f8f8f2>,</span> <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>rand</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>Int</span><span style=color:#f8f8f2>(</span><span style=color:#a6e22e>rand</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>Reader</span><span style=color:#f8f8f2>,</span> <span style=color:#a6e22e>big</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>NewInt</span><span style=color:#f8f8f2>(</span><span style=color:#ae81ff>100</span><span style=color:#f8f8f2>))</span> <span style=color:#75715e>// XXX Check err</span>

	<span style=color:#a6e22e>template</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>x509</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>Certificate</span><span style=color:#f8f8f2>{</span>
		<span style=color:#a6e22e>SerialNumber</span><span style=color:#f8f8f2>:</span> <span style=color:#a6e22e>serialNumber</span><span style=color:#f8f8f2>,</span>
		<span style=color:#a6e22e>Subject</span><span style=color:#f8f8f2>:</span> <span style=color:#a6e22e>pkix</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>Name</span><span style=color:#f8f8f2>{</span>
			<span style=color:#a6e22e>Organization</span><span style=color:#f8f8f2>:</span> <span style=color:#f8f8f2>[]</span><span style=color:#66d9ef>string</span><span style=color:#f8f8f2>{</span><span style=color:#e6db74>&quot;Example Co&quot;</span><span style=color:#f8f8f2>},</span>
		<span style=color:#f8f8f2>},</span>
		<span style=color:#a6e22e>NotBefore</span><span style=color:#f8f8f2>:</span>             <span style=color:#a6e22e>time</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>Now</span><span style=color:#f8f8f2>(),</span>
		<span style=color:#a6e22e>NotAfter</span><span style=color:#f8f8f2>:</span>              <span style=color:#a6e22e>time</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>Now</span><span style=color:#f8f8f2>().</span><span style=color:#a6e22e>Add</span><span style=color:#f8f8f2>(</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>Hour</span><span style=color:#f8f8f2>),</span>
		<span style=color:#a6e22e>KeyUsage</span><span style=color:#f8f8f2>:</span>              <span style=color:#a6e22e>x509</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>KeyUsageKeyEncipherment</span> <span style=color:#f8f8f2>|</span> <span style=color:#a6e22e>x509</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>KeyUsageDigitalSignature</span><span style=color:#f8f8f2>,</span>
		<span style=color:#a6e22e>ExtKeyUsage</span><span style=color:#f8f8f2>:</span>           <span style=color:#f8f8f2>[]</span><span style=color:#a6e22e>x509</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>ExtKeyUsage</span><span style=color:#f8f8f2>{</span><span style=color:#a6e22e>x509</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>ExtKeyUsageServerAuth</span><span style=color:#f8f8f2>},</span>
		<span style=color:#a6e22e>BasicConstraintsValid</span><span style=color:#f8f8f2>:</span> <span style=color:#66d9ef>true</span><span style=color:#f8f8f2>,</span>
	<span style=color:#f8f8f2>}</span>

	<span style=color:#a6e22e>derBytes</span><span style=color:#f8f8f2>,</span> <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>x509</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>CreateCertificate</span><span style=color:#f8f8f2>(</span><span style=color:#a6e22e>rand</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>Reader</span><span style=color:#f8f8f2>,</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>template</span><span style=color:#f8f8f2>,</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>template</span><span style=color:#f8f8f2>,</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>rsaKey</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>PublicKey</span><span style=color:#f8f8f2>,</span> <span style=color:#a6e22e>rsaKey</span><span style=color:#f8f8f2>)</span> <span style=color:#75715e>// XXX Check err</span>
	<span style=color:#a6e22e>certificate</span><span style=color:#f8f8f2>,</span> <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>x509</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>ParseCertificate</span><span style=color:#f8f8f2>(</span><span style=color:#a6e22e>derBytes</span><span style=color:#f8f8f2>)</span>                                                   <span style=color:#75715e>// XXX Check err</span>

	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>jose</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>JSONWebKeySet</span><span style=color:#f8f8f2>{</span>
		<span style=color:#a6e22e>Keys</span><span style=color:#f8f8f2>:</span> <span style=color:#f8f8f2>[]</span><span style=color:#a6e22e>jose</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>JSONWebKey</span><span style=color:#f8f8f2>{</span>
			<span style=color:#f8f8f2>{</span>
				<span style=color:#a6e22e>Certificates</span><span style=color:#f8f8f2>:</span> <span style=color:#f8f8f2>[]</span><span style=color:#f92672>*</span><span style=color:#a6e22e>x509</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>Certificate</span><span style=color:#f8f8f2>{</span><span style=color:#a6e22e>certificate</span><span style=color:#f8f8f2>},</span>
				<span style=color:#a6e22e>Key</span><span style=color:#f8f8f2>:</span>          <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>rsaKey</span><span style=color:#f8f8f2>.</span><span style=color:#a6e22e>PublicKey</span><span style=color:#f8f8f2>,</span>
				<span style=color:#a6e22e>KeyID</span><span style=color:#f8f8f2>:</span>        <span style=color:#e6db74>&quot;someKeyID&quot;</span><span style=color:#f8f8f2>,</span>
				<span style=color:#a6e22e>Use</span><span style=color:#f8f8f2>:</span>          <span style=color:#e6db74>&quot;sig&quot;</span><span style=color:#f8f8f2>,</span>
			<span style=color:#f8f8f2>},</span>
		<span style=color:#f8f8f2>},</span>
	<span style=color:#f8f8f2>}</span>
<span style=color:#f8f8f2>}</span>
</code></pre></div><hr><p><img src=https://media.giphy.com/media/83QtfwKWdmSEo/giphy.gif alt="The more you know" title="The more you know"></p><br><p class=back-to-posts><a href=/archive.html>Back to posts</a></div><br><div class=disqus></div></div></div></section>